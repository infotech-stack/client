<div class="container">
  <div class="row mt-1">
    <div class="col-12">
      <div class="header-bar">
        <h2 class="mb-0">TASK SCHEDULER</h2>
      </div>
    </div>
  </div>
  <div class="container mt-5">
    <div class="card">
      <div class="card-body">
        <form [formGroup]="taskForm">
          <div class="row">
            <!-- First Row: Project Name and Start Date -->
            <div class="col-12 col-md-6">
              <div class="mb-3">
                <label for="projectName" class="form-label fw-bold">Project Name</label>
                <input type="text" id="projectName" class="form-control" formControlName="projectName" placeholder="project name">
                <div *ngIf="taskForm.controls['projectName'].invalid && (taskForm.controls['projectName'].dirty || taskForm.controls['projectName'].touched)" class="text-danger">
                  <div *ngIf="taskForm.controls['projectName'].errors?.['required']">Project Name is required.</div>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="mb-3">
                <label for="startDate" class="form-label fw-bold">Start Date</label>
                <input type="date" id="startDate" class="form-control" formControlName="startDate">
                <div *ngIf="taskForm.controls['startDate'].invalid && (taskForm.controls['startDate'].dirty || taskForm.controls['startDate'].touched)" class="text-danger">
                  <div *ngIf="taskForm.controls['startDate'].errors?.['required']">Start Date is required.</div>
                </div>
              </div>
            </div>
          </div>
  
          <div class="row">
            <!-- Second Row: End Date and Project Status -->
            <div class="col-12 col-md-6">
              <div class="mb-3">
                <label for="endDate" class="form-label fw-bold">End Date</label>
                <input type="date" id="endDate" class="form-control" formControlName="endDate">
                <div *ngIf="taskForm.controls['endDate'].invalid && (taskForm.controls['endDate'].dirty || taskForm.controls['endDate'].touched)" class="text-danger">
                  <div *ngIf="taskForm.controls['endDate'].errors?.['required']">End Date is required.</div>
                </div>
              </div>
            </div>
            <div class="col-12 col-md-6">
              <div class="mb-3">
                <label for="projectStatus" class="form-label fw-bold">Project Status</label>
                <select id="projectStatus" class="form-select" formControlName="projectStatus" >
                  <option value="">Select project status</option>
                  <option value="In Progress" *ngFor="let status of taskStatus" [value]="status">{{status}}</option>
                  
                </select>
                <div *ngIf="taskForm.controls['projectStatus'].invalid && (taskForm.controls['projectStatus'].dirty || taskForm.controls['projectStatus'].touched)" class="text-danger">
                  <div *ngIf="taskForm.controls['projectStatus'].errors?.['required']">Project Status is required.</div>
                </div>
              </div>
            </div>
          </div>
  
          <div class="row">
            <!-- Third Row: Assign To (Employee Selection) -->
            <div class="col-12">
              <div class="mb-3">
                <label for="assignTo" class="form-label fw-bold">Assign To</label>
                <!-- <select id="assignTo" class="form-select" multiple (change)="getEmployeeId($event)" formControlName="assignTo">
                  <option value="0">All</option>
                  <option *ngFor="let employee of employees" [value]="employee.empId">{{ employee.employee_name }}</option>
                </select> -->
                <mat-form-field appearance="outline" class="w-100">
                  <mat-select id="assignTo" (selectionChange)="getEmployeeId($event)" formControlName="assignTo" multiple placeholder="Select employee">
                    <mat-option [value]="'all'">All</mat-option>
                    <mat-option *ngFor="let role of employees" [value]="role.employee_name">
                      {{role.employee_name}}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
                
                <div *ngIf="taskForm.controls['assignTo'].invalid && (taskForm.controls['assignTo'].dirty || taskForm.controls['assignTo'].touched)" class="text-danger">
                  <div *ngIf="taskForm.controls['assignTo'].errors?.['required']">Assign To is required.</div>
                </div>
              </div>
            </div>
          </div>
  
          <div class="row justify-content-center">
            <div class="col-12 text-center">
              <button type="submit" class="btn btn-primary" *ngIf="addFlag" (click)="taskAssign()">Assign Task</button>
              <button type="submit" class="btn btn-warning" *ngIf="editFlag" (click)="updateTask()">Edit Task</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>
  <div class="container mt-3">
    <div class="card" style="border-top: 3px solid blue;">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover table-bordered">
            <thead>
              <tr>
                <th scope="col">Employee Name</th>
                <th scope="col">Project Name</th>
                <th scope="col">Start Date</th>
                <th scope="col">End Date</th>
                <th scope="col">Project Status</th>
                <th scope="col">Action</th>
              </tr>
            </thead>
            <tbody>
              <!-- Iterate over each employee's taskDetails -->
              <ng-container *ngFor="let empDetails of taskDetails">
                <tr *ngFor="let task of empDetails.taskDetails">
                  <td>{{ empDetails.employee_name }}</td> <!-- Employee Name -->
                  <td>{{ task.project_name  }}</td> <!-- Project Name -->
                  <td>{{ task.start_date | date }}</td> <!-- Start Date -->
                  <td>{{ task.end_date  | date }}</td> <!-- End Date -->
                  <td>
                    <span [ngClass]="getBadgeClass(task.project_status)">{{ task.project_status }}</span>
                  </td>
                  <td>
                    <div class="d-flex gap-2">
                      <button class="btn btn-sm btn-warning" (click)="editTask(task,empDetails)">Edit</button>
                      <button class="btn btn-sm btn-danger" (click)="deleteTask(task,empDetails)">Delete</button>
                    </div>
                  </td>
                </tr>
              </ng-container>
              <!-- End of iteration -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>  
  </div>
  